<!doctype html>




<html class="theme-next mist" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Djinni,Cpp,Android,iOS," />





  <link rel="alternate" href="/atom.xml" title="Flower Crown Eevee" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content=".post-body .fancybox img {     margin: 0 auto 25px; }   Djinni æ˜¯ä¸€ä¸ªç”¨æ¥ç”Ÿæˆè·¨è¯­è¨€çš„ç±»å‹å£°æ˜å’Œæ¥å£ç»‘å®šçš„å·¥å…·ï¼Œä¸»è¦ç”¨äº C++ å’Œ Java ä»¥åŠ Objective-C é—´çš„äº’é€šã€‚ æ­¤æ–‡ï¼Œå°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Djinni å¼€å‘ Android, iOS çš„å…±äº«åº“ã€‚è¿™ä¼šå¸¦æ¥å‡ ä¸ªå¥½å¤„ï¼š  ç”¨äº†æ¥å£æè¿°æ–‡ä»¶ã€‚å£°æ˜æ¸…æ™°ã€ä¿®æ”¹ç®€æ˜“ï¼Œå¹¶ä¿è¯äº†è·¨å¹³">
<meta name="keywords" content="Djinni,Cpp,Android,iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="ä½¿ç”¨ Djinni å¼€å‘ Android, iOS å…±äº«åº“">
<meta property="og:url" content="http://eevee.cc/2016/05/06/using-djinni/index.html">
<meta property="og:site_name" content="Flower Crown Eevee">
<meta property="og:description" content=".post-body .fancybox img {     margin: 0 auto 25px; }   Djinni æ˜¯ä¸€ä¸ªç”¨æ¥ç”Ÿæˆè·¨è¯­è¨€çš„ç±»å‹å£°æ˜å’Œæ¥å£ç»‘å®šçš„å·¥å…·ï¼Œä¸»è¦ç”¨äº C++ å’Œ Java ä»¥åŠ Objective-C é—´çš„äº’é€šã€‚ æ­¤æ–‡ï¼Œå°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Djinni å¼€å‘ Android, iOS çš„å…±äº«åº“ã€‚è¿™ä¼šå¸¦æ¥å‡ ä¸ªå¥½å¤„ï¼š  ç”¨äº†æ¥å£æè¿°æ–‡ä»¶ã€‚å£°æ˜æ¸…æ™°ã€ä¿®æ”¹ç®€æ˜“ï¼Œå¹¶ä¿è¯äº†è·¨å¹³">
<meta property="og:image" content="http://eevee.cc/2016/05/06/using-djinni/cpp_pro_structure.png">
<meta property="og:image" content="http://eevee.cc/2016/05/06/using-djinni/cpp_pro_move.png">
<meta property="og:image" content="http://eevee.cc/2016/05/06/using-djinni/ios_pro_new.png">
<meta property="og:image" content="http://eevee.cc/2016/05/06/using-djinni/ios_pro_new_2.png">
<meta property="og:image" content="http://eevee.cc/2016/05/06/using-djinni/ios_pro_lib_header.png">
<meta property="og:image" content="http://eevee.cc/2016/05/06/using-djinni/ios_pro_result.png">
<meta property="og:updated_time" content="2017-05-09T02:06:48.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä½¿ç”¨ Djinni å¼€å‘ Android, iOS å…±äº«åº“">
<meta name="twitter:description" content=".post-body .fancybox img {     margin: 0 auto 25px; }   Djinni æ˜¯ä¸€ä¸ªç”¨æ¥ç”Ÿæˆè·¨è¯­è¨€çš„ç±»å‹å£°æ˜å’Œæ¥å£ç»‘å®šçš„å·¥å…·ï¼Œä¸»è¦ç”¨äº C++ å’Œ Java ä»¥åŠ Objective-C é—´çš„äº’é€šã€‚ æ­¤æ–‡ï¼Œå°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Djinni å¼€å‘ Android, iOS çš„å…±äº«åº“ã€‚è¿™ä¼šå¸¦æ¥å‡ ä¸ªå¥½å¤„ï¼š  ç”¨äº†æ¥å£æè¿°æ–‡ä»¶ã€‚å£°æ˜æ¸…æ™°ã€ä¿®æ”¹ç®€æ˜“ï¼Œå¹¶ä¿è¯äº†è·¨å¹³">
<meta name="twitter:image" content="http://eevee.cc/2016/05/06/using-djinni/cpp_pro_structure.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '6273277081015027000',
      author: 'Eevee'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://eevee.cc/2016/05/06/using-djinni/"/>





  <title>ä½¿ç”¨ Djinni å¼€å‘ Android, iOS å…±äº«åº“ | Flower Crown Eevee</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  







  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=55592908";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Flower Crown Eevee</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://eevee.cc/2016/05/06/using-djinni/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Eevee">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Flower Crown Eevee">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">ä½¿ç”¨ Djinni å¼€å‘ Android, iOS å…±äº«åº“</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-05-06T15:30:41+08:00">
                2016-05-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tech/" itemprop="url" rel="index">
                    <span itemprop="name">Tech</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a class="cloud-tie-join-count" href="/2016/05/06/using-djinni/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count join-count" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
<style type="text/css">
.post-body .fancybox img {
    margin: 0 auto 25px;
}
</style>

<p><a href="https://github.com/dropbox/djinni" target="_blank" rel="external">Djinni</a> æ˜¯ä¸€ä¸ªç”¨æ¥ç”Ÿæˆè·¨è¯­è¨€çš„ç±»å‹å£°æ˜å’Œæ¥å£ç»‘å®šçš„å·¥å…·ï¼Œä¸»è¦ç”¨äº C++ å’Œ Java ä»¥åŠ Objective-C é—´çš„äº’é€šã€‚</p>
<p>æ­¤æ–‡ï¼Œå°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ <a href="https://github.com/dropbox/djinni" target="_blank" rel="external">Djinni</a> å¼€å‘ Android, iOS çš„å…±äº«åº“ã€‚è¿™ä¼šå¸¦æ¥å‡ ä¸ªå¥½å¤„ï¼š</p>
<ul>
<li>ç”¨äº†æ¥å£æè¿°æ–‡ä»¶ã€‚å£°æ˜æ¸…æ™°ã€ä¿®æ”¹ç®€æ˜“ï¼Œå¹¶ä¿è¯äº†è·¨å¹³å°æ¥å£çš„ä¸€è‡´æ€§ã€‚</li>
<li>è‡ªåŠ¨ç”Ÿæˆæ¥å£ç»‘å®šä»£ç ã€‚å…å»äº†ç»‘å®š C++ å’Œ Java (JNI) åŠ Objective-C (Objective-C++) çš„éº»çƒ¦ã€‚</li>
</ul>
<h2 id="åˆè§ï¼šDjinni-åŠå…¶æ ·ä¾‹"><a href="#åˆè§ï¼šDjinni-åŠå…¶æ ·ä¾‹" class="headerlink" title="åˆè§ï¼šDjinni åŠå…¶æ ·ä¾‹"></a>åˆè§ï¼šDjinni åŠå…¶æ ·ä¾‹</h2><h3 id="ä¸‹è½½-Djinni"><a href="#ä¸‹è½½-Djinni" class="headerlink" title="ä¸‹è½½ Djinni"></a>ä¸‹è½½ Djinni</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/dropbox/djinni.git</div></pre></td></tr></table></figure>
<h3 id="ç¼–è¯‘-Djinni"><a href="#ç¼–è¯‘-Djinni" class="headerlink" title="ç¼–è¯‘ Djinni"></a>ç¼–è¯‘ Djinni</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> [djinni_root]/</div><div class="line">$ src/build</div></pre></td></tr></table></figure>
<p>äº<code>[djinni_root]/src/support/sbt.resolvers.properties</code>å†…å¯æ·»åŠ é•œåƒæºã€‚</p>
<ul>
<li><a href="http://www.zhihu.com/question/31158252" target="_blank" rel="external">sbtä¸‹è½½æ…¢ï¼Ÿ</a></li>
</ul>
<h3 id="ä½¿ç”¨-Djinni"><a href="#ä½¿ç”¨-Djinni" class="headerlink" title="ä½¿ç”¨ Djinni"></a>ä½¿ç”¨ Djinni</h3><a id="more"></a>
<p>ç”Ÿæˆæ ·ä¾‹æ¥å£ä»£ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> [djinni_root]/example/  <span class="comment"># example_root</span></div><div class="line">$ ./run_djinni.sh</div></pre></td></tr></table></figure>
<p>å³ä¼šç”Ÿæˆåˆ°<code>djinni-output-temp</code>ä¸´æ—¶ç›®å½•ï¼Œæœ€ç»ˆå¤åˆ¶åˆ°<code>generated-src</code>ç”Ÿæˆç›®å½•ã€‚</p>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼šä¾æ®æè¿°æ–‡ä»¶<code>example.djinni</code>ï¼ŒC++ å’Œ Java åŠ Objective-C çš„ç»‘å®šä»£ç éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆå¥½ã€‚ç»§ç»­è¦åšçš„ï¼Œåªæ˜¯å†™å®ƒä»¬çš„å…·ä½“å®ç°ï¼Œè§æ ·ä¾‹çš„<code>handwritten-src</code>ç›®å½•ã€‚</p>
<p>å¦‚æœè¦æ¸…é™¤è¾“å‡ºç›®å½•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./run_djinni.sh clean</div></pre></td></tr></table></figure>
<h3 id="ç¼–è¯‘æ ·ä¾‹"><a href="#ç¼–è¯‘æ ·ä¾‹" class="headerlink" title="ç¼–è¯‘æ ·ä¾‹"></a>ç¼–è¯‘æ ·ä¾‹</h3><p><code>[djinni_root]/Makefile</code>å·²é…ç½®å¥½äº†ä¾èµ–ï¼Œæ‰§è¡Œç›¸åº”ç›®æ ‡å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> [djinni_root]/</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šä¸‹è½½å¥½ Djinni ï¼Œå³å¯å¼€å§‹ç¼–è¯‘æ ·ä¾‹äº†ã€‚</p>
</blockquote>
<p>ç¼–è¯‘ Android å·¥ç¨‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ make example_android</div></pre></td></tr></table></figure>
<p>æ ·ä¾‹çš„ Android å·¥ç¨‹åœ¨<code>[example_root]/android</code>ç›®å½•ï¼Œ åŠ¨æ€åº“ç”Ÿæˆåœ¨<code>[example_root]/android/app/libs</code>ç›®å½•ã€‚æˆ–è€…ï¼Œåˆ©ç”¨ Android Studio / Gradle æ¥è¿è¡Œç¼–è¯‘ã€‚</p>
<p>ç¼–è¯‘ iOS å·¥ç¨‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ make example_ios</div></pre></td></tr></table></figure>
<p>æ ·ä¾‹çš„ iOS å·¥ç¨‹åœ¨<code>[example_root]/objc</code>ç›®å½•ï¼Œ lib å·¥ç¨‹ç”Ÿæˆåœ¨<code>[djinni_root]\build_ios</code>ç›®å½•ã€‚ç„¶åï¼Œå¯ä»¥æ‰“å¼€<code>[example_root]/objc/TextSort.xcworkspace</code>æ¥è¿è¡Œç¼–è¯‘ã€‚</p>
<p>å¦‚æœè¦æ¸…ç†å·¥ç¨‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ make clean</div></pre></td></tr></table></figure>
<h3 id="å‡†å¤‡-GYP"><a href="#å‡†å¤‡-GYP" class="headerlink" title="å‡†å¤‡ GYP"></a>å‡†å¤‡ GYP</h3><p>ç¼–è¯‘æ ·ä¾‹æ—¶ï¼Œ Android NDK ä¸ iOS çš„ Library å·¥ç¨‹éƒ½éœ€ä¾èµ– GYP ç”Ÿæˆã€‚ make æ—¶ï¼Œä¼šè‡ªè¡Œ clone åˆ°<code>[djinni_root]/deps/gyp</code>ç›®å½•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://chromium.googlesource.com/external/gyp.git</div></pre></td></tr></table></figure>
<p>GYP ç”Ÿæˆ Android Makefile æ—¶ï¼Œç›®å‰ä¼šé‡åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p>
<blockquote>
<p>ImportError: No module named android</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œéœ€è¦åˆ‡æ¢åˆ°æ—§ç‰ˆæœ¬ã€‚æ­¤åçš„é‚£ä¸ª commit ç§»é™¤äº† Android çš„ç”Ÿæˆå™¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ cd gyp/</div><div class="line">$ git checkout -q 0bb67471bca068996e15b56738fa4824dfa19de0</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼š<a href="https://github.com/dropbox/djinni/issues/87" target="_blank" rel="external">Stop using gypâ€™s android generator</a></p>
</blockquote>
<h2 id="ä»æ— åˆ°æœ‰ï¼šHello-Djinni"><a href="#ä»æ— åˆ°æœ‰ï¼šHello-Djinni" class="headerlink" title="ä»æ— åˆ°æœ‰ï¼šHello Djinni"></a>ä»æ— åˆ°æœ‰ï¼šHello Djinni</h2><h3 id="C-æ¥å£"><a href="#C-æ¥å£" class="headerlink" title="C++ æ¥å£"></a>C++ æ¥å£</h3><h4 id="å®šä¹‰æ¥å£æè¿°æ–‡ä»¶"><a href="#å®šä¹‰æ¥å£æè¿°æ–‡ä»¶" class="headerlink" title="å®šä¹‰æ¥å£æè¿°æ–‡ä»¶"></a>å®šä¹‰æ¥å£æè¿°æ–‡ä»¶</h4><figure class="highlight bash"><figcaption><span>hellodjinni.djinni</span><a href="https://github.com/joinAero/XCalculator/blob/master/sample/hellodjinni/hellodjinni.djinni" target="_blank" rel="external">hellodjinni.djinni</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hello_djinni = interface +c &#123;</div><div class="line">    static create(): hello_djinni;</div><div class="line">    get_hello_djinni(): string;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç”Ÿæˆæ¥å£ç»‘å®šä»£ç "><a href="#ç”Ÿæˆæ¥å£ç»‘å®šä»£ç " class="headerlink" title="ç”Ÿæˆæ¥å£ç»‘å®šä»£ç "></a>ç”Ÿæˆæ¥å£ç»‘å®šä»£ç </h4><p>å†™äº†ä¸ªç®€å•çš„ Shell è„šæœ¬æ¥æ‰§è¡Œ Djinni å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><figcaption><span>run_djinni.sh:</span><a href="https://github.com/joinAero/XCalculator/blob/master/sample/hellodjinni/run_djinni.sh" target="_blank" rel="external">run_djinni.sh</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="built_in">set</span> <span class="_">-e</span></div><div class="line"><span class="built_in">shopt</span> <span class="_">-s</span> nullglob</div><div class="line"></div><div class="line">base_dir=$(<span class="built_in">cd</span> <span class="string">"`dirname "</span><span class="variable">$0</span><span class="string">"`"</span> &amp;&amp; <span class="built_in">pwd</span>)</div><div class="line"></div><div class="line"><span class="comment"># Read local properties</span></div><div class="line"><span class="built_in">eval</span> $(cat <span class="variable">$base_dir</span>/local.properties | sed <span class="string">'s/&lt;[^&gt;]*&gt;//g'</span> | sed <span class="string">'s/\./_/g'</span>)</div><div class="line"><span class="keyword">if</span> [[ -z <span class="variable">$djinni_dir</span> ]]; <span class="keyword">then</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"Unspecified djinni.dir in local.properties"</span> 1&gt;&amp;2</div><div class="line">    <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"></div><div class="line">out_dir=<span class="string">"<span class="variable">$base_dir</span>/generated-src"</span></div><div class="line"></div><div class="line">cpp_out=<span class="string">"<span class="variable">$out_dir</span>/cpp"</span></div><div class="line">jni_out=<span class="string">"<span class="variable">$out_dir</span>/jni"</span></div><div class="line">objc_out=<span class="string">"<span class="variable">$out_dir</span>/objc"</span></div><div class="line">java_out=<span class="string">"<span class="variable">$out_dir</span>/java/cc/eevee/hellodjinni"</span></div><div class="line"></div><div class="line">java_package=<span class="string">"cc.eevee.hellodjinni"</span></div><div class="line">cpp_namespace=<span class="string">"hellodjinni"</span></div><div class="line">objc_type_prefix=<span class="string">"HD"</span></div><div class="line">djinni_file=<span class="string">"<span class="variable">$base_dir</span>/hellodjinni.djinni"</span></div><div class="line"></div><div class="line"></div><div class="line">[[ <span class="_">-e</span> <span class="variable">$out_dir</span> ]] &amp;&amp; rm -rf <span class="variable">$out_dir</span></div><div class="line"></div><div class="line"><span class="variable">$djinni_dir</span>/src/run-assume-built \</div><div class="line">    --java-out <span class="variable">$java_out</span> \</div><div class="line">    --java-package <span class="variable">$java_package</span> \</div><div class="line">    --ident-java-field mFooBar \</div><div class="line">    \</div><div class="line">    --cpp-out <span class="variable">$cpp_out</span> \</div><div class="line">    --cpp-namespace <span class="variable">$cpp_namespace</span> \</div><div class="line">    \</div><div class="line">    --jni-out <span class="variable">$jni_out</span> \</div><div class="line">    --ident-jni-class NativeFooBar \</div><div class="line">    --ident-jni-file NativeFooBar \</div><div class="line">    \</div><div class="line">    --objc-out <span class="variable">$objc_out</span> \</div><div class="line">    --objcpp-out <span class="variable">$objc_out</span> \</div><div class="line">    --objc-type-prefix <span class="variable">$objc_type_prefix</span> \</div><div class="line">    \</div><div class="line">    --idl <span class="variable">$djinni_file</span></div></pre></td></tr></table></figure>
<p>å…¶è¯»å–äº†<code>local.properties</code>å†…é…ç½®çš„ Djinni ç›®å½•è·¯å¾„ã€‚</p>
<figure class="highlight bash"><figcaption><span>local.properties</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/local.properties" target="_blank" rel="external">local.properties</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">djinni.dir=&lt;path-to-djinni&gt;</div><div class="line">gyp.dir=&lt;path-to-gyp&gt;</div><div class="line">ndk.dir=&lt;path-to-ndk&gt;</div></pre></td></tr></table></figure>
<p>è¿è¡Œåï¼Œä»£ç ç”Ÿæˆåœ¨äº†<code>generated-src</code>ç›®å½•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./run_djinni.sh</div></pre></td></tr></table></figure>
<h4 id="å®ç°-C-æ¥å£"><a href="#å®ç°-C-æ¥å£" class="headerlink" title="å®ç° C++ æ¥å£"></a>å®ç° C++ æ¥å£</h4><p>é¦–å…ˆï¼Œåˆ›å»º<code>src</code>ç›®å½•ï¼Œå­˜æ”¾æ‰‹å†™çš„ä»£ç ã€‚ç„¶åï¼Œäºå­ç›®å½•<code>cpp</code>å†…å®ç° C++ æ¥å£ã€‚</p>
<figure class="highlight hpp"><figcaption><span>src/cpp/hello_djinni_impl.hpp</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/src/cpp/hello_djinni_impl.hpp" target="_blank" rel="external">hello_djinni_impl.hpp</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hello_djinni.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> hellodjinni &#123;</div><div class="line"></div><div class="line"><span class="keyword">class</span> HelloDjinniImpl : <span class="keyword">public</span> HelloDjinni &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Constructor</span></div><div class="line">    HelloDjinniImpl();</div><div class="line"></div><div class="line">    <span class="comment">// Our method that returns a string</span></div><div class="line">    <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">get_hello_djinni</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">&#125;  <span class="comment">// namespace hellodjinni</span></div></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>src/cpp/hello_djinni_impl.cpp</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/src/cpp/hello_djinni_impl.cpp" target="_blank" rel="external">hello_djinni_impl.cpp</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hello_djinni_impl.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> hellodjinni;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">shared_ptr</span>&lt;HelloDjinni&gt; HelloDjinni::create() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">std</span>::make_shared&lt;HelloDjinniImpl&gt;();</div><div class="line">&#125;</div><div class="line"></div><div class="line">HelloDjinniImpl::HelloDjinniImpl() &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">string</span> HelloDjinniImpl::get_hello_djinni() &#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> result = <span class="string">"Hello Djinni! "</span>;</div><div class="line"></div><div class="line">    <span class="keyword">time_t</span> t = time(<span class="number">0</span>);</div><div class="line">    tm now = *localtime(&amp;t);</div><div class="line"></div><div class="line">    <span class="keyword">char</span> tm_desc[<span class="number">200</span>] = &#123;<span class="number">0</span>&#125;;</div><div class="line">    <span class="keyword">if</span> (strftime(tm_desc, <span class="keyword">sizeof</span>(tm_desc)<span class="number">-1</span>, <span class="string">"%r"</span>, &amp;now)&gt;<span class="number">0</span>) &#123;</div><div class="line">        result += tm_desc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="C-å·¥ç¨‹"><a href="#C-å·¥ç¨‹" class="headerlink" title="C++ å·¥ç¨‹"></a>C++ å·¥ç¨‹</h3><p>è¿™é‡Œç”¨ XCode åˆ›å»ºä¸€ä¸ª C++ å·¥ç¨‹ï¼Œæ¥æµ‹è¯• C++ æ¥å£ä»£ç ã€‚</p>
<p>é¦–å…ˆï¼Œæ‰“å¼€ XCode ï¼Œé€‰æ‹©â€Create a new Xcode projectâ€ã€‚ç„¶åï¼Œé€‰æ‹©â€Command Line Toolâ€ï¼Œæ¥æ–°å»ºå‘½ä»¤è¡Œå·¥å…·ã€‚</p>
{% asset_img cpp_pro_new.png %}
<p>â€œNextâ€åˆ°ä¸‹ä¸€æ­¥æ—¶ï¼Œâ€Languageâ€é€‰æ‹©â€C++â€ã€‚</p>
{% asset_img cpp_pro_new_2.png %}
<p>å·¥ç¨‹æœ€åä¿å­˜åˆ°äº†<code>project/cpp</code>ç›®å½•ã€‚æ•´ä¸ªæ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<img src="/2016/05/06/using-djinni/cpp_pro_structure.png" width="240">
<p>æ¥ä¸‹æ¥ï¼ŒæŠŠä»¥ä¸‹ C++ æ¥å£ä»£ç æ–‡ä»¶ï¼Œæ‹–åŠ¨åˆ° XCode å·¥ç¨‹ç›®å½•æ¥å¼•å…¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">generated-src/cpp/hello_djinni.hpp</div><div class="line">src/cpp/hello_djinni_impl.cpp</div><div class="line">src/cpp/hello_djinni_impl.hpp</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šå–æ¶ˆâ€Copy items if neededâ€ï¼Œé€‰æ‹©â€Create folder referencesâ€ã€‚åªéœ€å¼•ç”¨æ–‡ä»¶ï¼Œé¿å…å¤åˆ¶ã€‚</p>
</blockquote>
<img src="/2016/05/06/using-djinni/cpp_pro_move.png" alt="cpp_pro_move.png" title="">
<p>ç„¶åï¼Œç¼–å†™å¥½<code>main.cpp</code>çš„ä»£ç ï¼š</p>
<figure class="highlight cpp"><figcaption><span>project/cpp/HelloDjinni/HelloDjinni/main.cpp</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/cpp/HelloDjinni/HelloDjinni/main.cpp" target="_blank" rel="external">main.cpp</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"hello_djinni_impl.hpp"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line">    <span class="keyword">typedef</span> hellodjinni::HelloDjinni HelloDjinni;</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> hd = HelloDjinni::create();</div><div class="line">    <span class="keyword">auto</span> result = hd-&gt;get_hello_djinni();</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; result &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€åï¼Œè¿è¡Œé¡¹ç›®ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
{% asset_img cpp_pro_overview.png %}
<p>æˆ–è€…ï¼Œå†™ä¸ª<code>project/Cpp.mk</code>ï¼š</p>
<figure class="highlight makefile"><figcaption><span>project/Cpp.mk</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/Cpp.mk" target="_blank" rel="external">Cpp.mk</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">MD := -mkdir -p</div><div class="line">RD := -rm -rf</div><div class="line">RM := -rm -f</div><div class="line"></div><div class="line">CC := gcc</div><div class="line">CXX := g++</div><div class="line">CXXFLAGS := -std=c++11 -Wall</div><div class="line"></div><div class="line">ifdef DEBUG</div><div class="line">CXXFLAGS += -g -DDEBUG</div><div class="line">else</div><div class="line">CXXFLAGS += -O2 -DNDEBUG</div><div class="line">endif</div><div class="line"></div><div class="line">OUT_DIR ?= build</div><div class="line">CPP_OUT ?= <span class="variable">$(OUT_DIR)</span>/cpp</div><div class="line"></div><div class="line">CPP_INCLUDES := \</div><div class="line">    ../generated-src/cpp \</div><div class="line">    ../src/cpp</div><div class="line">CPP_SOURCES := \</div><div class="line">    ../src/cpp/hello_djinni_impl.cpp \</div><div class="line">    cpp/HelloDjinni/HelloDjinni/main.cpp</div><div class="line">CPP_TARGET := <span class="variable">$(CPP_OUT)</span>/HelloDjinni</div><div class="line"></div><div class="line"></div><div class="line">all: cpp_pro</div><div class="line"></div><div class="line"><span class="section">clean:</span></div><div class="line">    $(RD) $(CPP_OUT)/</div><div class="line"></div><div class="line">cpp_pro: $(CPP_SOURCES)</div><div class="line">    @echo "\033[1;35;47mBuild cpp project...\033[0m"</div><div class="line">    @$(MD) $(CPP_OUT)</div><div class="line">    $(CXX) $(CXXFLAGS) $(CPP_SOURCES) -o $(CPP_TARGET) \</div><div class="line">        $(foreach d, $(CPP_INCLUDES), -I$d)</div><div class="line">    @echo "\033[32mOutput:\033[0m\n$(CPP_TARGET)"</div><div class="line">    @echo "\033[32mRunning:\033[0m"</div><div class="line">    @$(CPP_TARGET)</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: cpp_pro clean all</span></div></pre></td></tr></table></figure>
<p>ç„¶åï¼Œ<code>make -f Cpp.mk</code>ç¼–è¯‘è¿è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Build cpp project...</div><div class="line">g++ -std=c++11 -Wall -O2 -DNDEBUG \</div><div class="line">    ../src/cpp/hello_djinni_impl.cpp \</div><div class="line">    cpp/HelloDjinni/HelloDjinni/main.cpp \</div><div class="line">    -o build/cpp/HelloDjinni \</div><div class="line">    -I../generated-src/cpp -I../src/cpp</div><div class="line">Output:</div><div class="line">build/cpp/HelloDjinni</div><div class="line">Running:</div><div class="line">Hello Djinni! 11:46:56 PM</div></pre></td></tr></table></figure>
<h3 id="iOS-å·¥ç¨‹"><a href="#iOS-å·¥ç¨‹" class="headerlink" title="iOS å·¥ç¨‹"></a>iOS å·¥ç¨‹</h3><p>æ‰“å¼€ XCodeï¼Œâ€File &gt; New &gt; Workspaceâ€æ–°å»ºä¸€ä¸ªå·¥ä½œåŒºï¼Œä¿å­˜åˆ°<code>project/ios</code>ç›®å½•ã€‚</p>
<p>æ¥ç€ï¼Œâ€File &gt; New &gt; Projectâ€ï¼Œé€‰æ‹©â€Single View Applicationâ€ï¼Œåˆ›å»º iOS å·¥ç¨‹ã€‚</p>
<img src="/2016/05/06/using-djinni/ios_pro_new.png" alt="ios_pro_new.png" title="">
<p>â€œNextâ€åˆ°ä¸‹ä¸€æ­¥æ—¶ï¼Œâ€Languageâ€é€‰æ‹©â€Objective-Câ€ã€‚</p>
<img src="/2016/05/06/using-djinni/ios_pro_new_2.png" alt="ios_pro_new_2.png" title="">
<p>å·¥ç¨‹ä¿å­˜åˆ°<code>project/ios</code>ç›®å½•ï¼Œâ€Add toâ€é€‰æ‹©åˆšæ‰çš„å·¥ä½œåŒºã€‚</p>
{% asset_img ios_pro_new_3.png %}
<p>â€œCreateâ€å®Œæˆåˆ›å»ºã€‚</p>
<h4 id="ç”Ÿæˆæ¥å£-Libraries-å·¥ç¨‹"><a href="#ç”Ÿæˆæ¥å£-Libraries-å·¥ç¨‹" class="headerlink" title="ç”Ÿæˆæ¥å£ Libraries å·¥ç¨‹"></a>ç”Ÿæˆæ¥å£ Libraries å·¥ç¨‹</h4><p>åˆ©ç”¨ Djinni, GYP åŠ Make ç”Ÿæˆæ¥å£ Libraries å·¥ç¨‹ã€‚</p>
<p>é¦–å…ˆï¼Œåˆ›å»º GYP æ–‡ä»¶ï¼š</p>
<figure class="highlight json"><figcaption><span>project/libhellodjinni.gyp</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/libhellodjinni.gyp" target="_blank" rel="external">libhellodjinni.gyp</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"targets"</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"target_name"</span>: <span class="string">"libhellodjinni_jni"</span>,</div><div class="line">      <span class="attr">"type"</span>: <span class="string">"shared_library"</span>,</div><div class="line">      <span class="attr">"dependencies"</span>: [</div><div class="line">        <span class="string">"&lt;(DJINNI_DIR)/support-lib/support_lib.gyp:djinni_jni"</span>,</div><div class="line">      ],</div><div class="line">      <span class="attr">"ldflags"</span>: [ <span class="string">"-llog"</span>, <span class="string">"-Wl,--build-id,--gc-sections,--exclude-libs,ALL"</span> ],</div><div class="line">      <span class="attr">"sources"</span>: [</div><div class="line">        <span class="string">"&lt;(DJINNI_DIR)/support-lib/jni/djinni_main.cpp"</span>,</div><div class="line">        <span class="string">"&lt;!@(python &lt;(DJINNI_DIR)/example/glob.py ../generated-src/jni '*.cpp')"</span>,</div><div class="line">        <span class="string">"&lt;!@(python &lt;(DJINNI_DIR)/example/glob.py ../generated-src/cpp '*.cpp')"</span>,</div><div class="line">        <span class="string">"&lt;!@(python &lt;(DJINNI_DIR)/example/glob.py ../src '*.cpp')"</span>,</div><div class="line">      ],</div><div class="line">      <span class="attr">"include_dirs"</span>: [</div><div class="line">        <span class="string">"../generated-src/jni"</span>,</div><div class="line">        <span class="string">"../generated-src/cpp"</span>,</div><div class="line">        <span class="string">"../src/cpp"</span>,</div><div class="line">      ],</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"target_name"</span>: <span class="string">"libhellodjinni_objc"</span>,</div><div class="line">      <span class="attr">"type"</span>: <span class="string">"static_library"</span>,</div><div class="line">      <span class="attr">"dependencies"</span>: [</div><div class="line">        <span class="string">"&lt;(DJINNI_DIR)/support-lib/support_lib.gyp:djinni_objc"</span>,</div><div class="line">      ],</div><div class="line">      <span class="attr">"sources"</span>: [</div><div class="line">        <span class="string">"&lt;!@(python &lt;(DJINNI_DIR)/example/glob.py ../generated-src/objc '*.cpp' '*.mm' '*.m')"</span>,</div><div class="line">        <span class="string">"&lt;!@(python &lt;(DJINNI_DIR)/example/glob.py ../generated-src/cpp  '*.cpp')"</span>,</div><div class="line">        <span class="string">"&lt;!@(python &lt;(DJINNI_DIR)/example/glob.py ../src '*.cpp')"</span>,</div><div class="line">      ],</div><div class="line">      <span class="attr">"include_dirs"</span>: [</div><div class="line">        <span class="string">"../generated-src/objc"</span>,</div><div class="line">        <span class="string">"../generated-src/cpp"</span>,</div><div class="line">        <span class="string">"../src/cpp"</span>,</div><div class="line">      ],</div><div class="line">    &#125;,</div><div class="line">  ],</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼š<br>1) <code>sources</code>å†…çš„è·¯å¾„å¿…é¡»æ˜¯ç›¸å¯¹è·¯å¾„ã€‚è™½ç„¶ä¼šè¯†åˆ«ä»¥<code>/</code>å¼€å¤´çš„å­—ç¬¦ä¸²ä¸ºç»å¯¹è·¯å¾„ï¼Œä½†åœ¨ XCode å·¥ç¨‹å†…å…¶è·¯å¾„å¼•ç”¨æ˜¯ä¸æ­£ç¡®çš„ã€‚<br>2) GYP ç”Ÿæˆ Android Makefile æ—¶ï¼Œè¿è¡Œå‘½ä»¤æ—¶çš„å·¥ä½œç›®å½•ï¼Œå¿…é¡»èƒ½å¤Ÿç›´æ¥å­ç›®å½•åˆ°æ‰€æœ‰ä»£ç ï¼ŒåŒ…æ‹¬ä¾èµ–çš„ Djinni çš„ support-lib ã€‚ä¸ç„¶ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<blockquote>
<p>AssertionError: Path %s attempts to escape from gyp path %s !)</p>
</blockquote>
<p>ğŸ‘Œçš„è¯ï¼Œ<code>GypAndroid.mk</code>ä¼šç”Ÿæˆåˆ°å½“å‰å·¥ä½œç›®å½•ã€‚GYP ç”Ÿæˆ Android æ—¶ï¼Œä¸å…è®¸æŒ‡å®š<code>--generator-output</code>ï¼š</p>
<blockquote>
<p>AssertionError: The Android backend does not support options.generator_output.</p>
</blockquote>
</blockquote>
<p>æ‰€ä»¥ï¼Œç®€å•çš„è§£å†³åŠæ³•æ˜¯ï¼Œæ–‡ä»¶ç»“æ„ä¸<code>[djinni_root]/example</code>ä¸€è‡´ï¼Œå¹¶<code>git submodule</code> Djinni ä¸ GYP åˆ°å·¥ç¨‹ç›®å½•å†…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git init</div><div class="line">$ git submodule add https://github.com/dropbox/djinni.git deps/djinni</div><div class="line">$ git submodule add https://chromium.googlesource.com/external/gyp.git deps/gyp</div></pre></td></tr></table></figure>
<p>å¦‚æœä»æƒ³è¦ Djinni ä¸ GYP ç‹¬ç«‹äºå·¥ç¨‹ç›®å½•å¤–ï¼ŒåŒæ—¶åˆèƒ½å¤Ÿå·¥ä½œåœ¨å·¥ç¨‹ç›®å½•ï¼Œé‚£ä¹ˆéœ€è¦æŠŠä¾èµ–çš„ä¸œè¥¿å¤åˆ¶è¿›å·¥ç¨‹ç›®å½•ã€‚ä¹‹åï¼Œå³æ˜¯è¿™æ ·åšçš„ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»º Makefile æ–‡ä»¶ï¼š</p>
<figure class="highlight makefile"><figcaption><span>project/Makefile</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/Makefile" target="_blank" rel="external">Makefile</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div></pre></td><td class="code"><pre><div class="line">MD := -mkdir -p</div><div class="line">RD := -rm -rf</div><div class="line">RM := -rm -f</div><div class="line"></div><div class="line">SED_PROP := "s/&lt;[^&gt;]*&gt;//g;s/.*=\(.*\)/\1/"</div><div class="line"></div><div class="line">define read_prop</div><div class="line">    $(eval $(1) := $(shell ../tools/read_properties.sh \</div><div class="line">        | grep -m1 $(2) | sed $(SED_PROP)))</div><div class="line">endef</div><div class="line"></div><div class="line">$(call read_prop,GYP_DIR,gyp_dir)</div><div class="line">$(call read_prop,NDK_DIR,ndk_dir)</div><div class="line"></div><div class="line"></div><div class="line">OUT_DIR ?= build</div><div class="line">IOS_OUT ?= <span class="variable">$(OUT_DIR)</span>/ios</div><div class="line"></div><div class="line">DEPS_DIR ?= deps</div><div class="line">DEPS_DJINNI_DIR := <span class="variable">$(DEPS_DIR)</span>/djinni</div><div class="line"></div><div class="line">DJINNI_OUT_DIR ?= ../generated-src</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: all</span></div><div class="line">all: cpp_pro ios_pro android_pro android_pro2</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: clean</span></div><div class="line"><span class="section">clean:</span></div><div class="line">    @make ios_pro_clean</div><div class="line">    @make android_pro_clean</div><div class="line">    @make android_pro2_clean</div><div class="line">    @echo "\033[1;35;47mClean others...\033[0m"</div><div class="line">    $(RD) $(OUT_DIR)/</div><div class="line">    $(RD) $(DEPS_DIR)/</div><div class="line">    $(RD) $(DJINNI_OUT_DIR)/</div><div class="line">    $(RM) ../GypAndroid.mk</div><div class="line">    $(RM) libhellodjinni_jni.target.mk</div><div class="line">    @<span class="comment"># @make cpp_pro_clean</span></div><div class="line"></div><div class="line"><span class="section">deps:</span></div><div class="line">    @echo "\033[1;35;47mPrepare dependencies...\033[0m"</div><div class="line">    @../tools/prepare_deps.sh $(DEPS_DIR)</div><div class="line"></div><div class="line">$(DJINNI_OUT_DIR): ../hellodjinni.djinni</div><div class="line">    @echo "\033[1;35;47mGenerate djinni interface code...\033[0m"</div><div class="line">    @../run_djinni.sh</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: djinni</span></div><div class="line">djinni: $(DJINNI_OUT_DIR)</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: cpp_pro</span></div><div class="line">cpp_pro: $(DJINNI_OUT_DIR)</div><div class="line">    @make -f Cpp.mk cpp_pro</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: cpp_pro_clean</span></div><div class="line"><span class="section">cpp_pro_clean:</span></div><div class="line">    @make -f Cpp.mk clean</div><div class="line"></div><div class="line">$(IOS_OUT)/libhellodjinni.xcodeproj: deps $(DJINNI_OUT_DIR) libhellodjinni.gyp \</div><div class="line">        $(DEPS_DJINNI_DIR)/support-lib/support_lib.gyp</div><div class="line">    @echo "\033[1;35;47mGenerate libhellodjinni.xcodeproj...\033[0m"</div><div class="line">    @$(GYP_DIR)/gyp --depth=. -f xcode -DOS=ios \</div><div class="line">        --generator-output $(IOS_OUT) \</div><div class="line">        -DDJINNI_DIR=$(DEPS_DJINNI_DIR) \</div><div class="line">        -I$(DEPS_DJINNI_DIR)/common.gypi \</div><div class="line">        libhellodjinni.gyp</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: ios_pro</span></div><div class="line">ios_pro: $(IOS_OUT)/libhellodjinni.xcodeproj</div><div class="line">    @echo "\033[1;35;47mBuild ios project...\033[0m"</div><div class="line">    xcodebuild -workspace ios/HelloDjinni.xcworkspace \</div><div class="line">        -scheme HelloDjinni -configuration 'Debug' -sdk iphonesimulator</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: ios_pro_clean</span></div><div class="line"><span class="section">ios_pro_clean:</span></div><div class="line">    @echo "\033[1;35;47mClean ios project...\033[0m"</div><div class="line">    @-xcodebuild -workspace ios/HelloDjinni.xcworkspace \</div><div class="line">        -scheme HelloDjinni -configuration 'Debug' -sdk iphonesimulator clean</div><div class="line"></div><div class="line">../GypAndroid.mk: deps $(DJINNI_OUT_DIR) libhellodjinni.gyp \</div><div class="line">        $(DEPS_DJINNI_DIR)/support-lib/support_lib.gyp</div><div class="line">    @echo "\033[1;35;47mGenerate GypAndroid.mk...\033[0m"</div><div class="line">    @make gyp_android</div><div class="line">    @cd .. &amp;&amp; ANDROID_BUILD_TOP=$(NDK_DIR) \</div><div class="line">        $(GYP_DIR)/gyp --depth=. -f android -DOS=android \</div><div class="line">        -DDJINNI_DIR=$(DEPS_DJINNI_DIR) \</div><div class="line">        -Iproject/$(DEPS_DJINNI_DIR)/common.gypi \</div><div class="line">        project/libhellodjinni.gyp \</div><div class="line">        --root-target=libhellodjinni_jni</div><div class="line">    @make gyp_master</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: android_pro</span></div><div class="line">android_pro: ../GypAndroid.mk</div><div class="line">    @echo "\033[1;35;47mBuild android project (HelloDjinni)...\033[0m"</div><div class="line">    cd android/HelloDjinni/ &amp;&amp; ./gradlew app:assembleDebug</div><div class="line">    @echo "\033[32mApks produced at:\033[0m"</div><div class="line">    @python $(DEPS_DJINNI_DIR)/example/glob.py \</div><div class="line">        android/HelloDjinni/app/build/outputs/apk/ '*.apk'</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: android_pro_clean</span></div><div class="line">android_pro_clean: ../GypAndroid.mk</div><div class="line">    @echo "\033[1;35;47mClean android project (HelloDjinni)...\033[0m"</div><div class="line">    @ndk-build -C android/HelloDjinni/app-core clean</div><div class="line">    @-cd android/HelloDjinni/ &amp;&amp; ./gradlew clean</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: android_pro2</span></div><div class="line">android_pro2: deps djinni libhellodjinni.gyp \</div><div class="line">        $(DEPS_DJINNI_DIR)/support-lib/support_lib.gyp</div><div class="line">    @echo "\033[1;35;47mBuild android project (HelloDjinni2)...\033[0m"</div><div class="line">    cd android/HelloDjinni2/ &amp;&amp; ./gradlew app:assembleDebug</div><div class="line">    @echo "\033[32mApks produced at:\033[0m"</div><div class="line">    @python $(DEPS_DJINNI_DIR)/example/glob.py \</div><div class="line">        android/HelloDjinni2/app/build/outputs/apk/ '*.apk'</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: android_pro2_clean</span></div><div class="line"><span class="section">android_pro2_clean:</span></div><div class="line">    @echo "\033[1;35;47mClean android project (HelloDjinni2)...\033[0m"</div><div class="line">    @-cd android/HelloDjinni2/ &amp;&amp; ./gradlew clean</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: gyp_status</span></div><div class="line"><span class="section">gyp_status:</span></div><div class="line">    @cd $(GYP_DIR) &amp;&amp; git status</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: gyp_master</span></div><div class="line"><span class="section">gyp_master:</span></div><div class="line">    @echo "\033[1;35;47mCheckout gyp to master...\033[0m"</div><div class="line">    @cd $(GYP_DIR) &amp;&amp; git checkout master</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: gyp_android</span></div><div class="line"><span class="section">gyp_android:</span></div><div class="line">    @echo "\033[1;35;47mCheckout gyp to android generator...\033[0m"</div><div class="line">    @cd $(GYP_DIR) &amp;&amp; git checkout -q 0bb67471bca068996e15b56738fa4824dfa19de0</div><div class="line"></div><div class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: test_vars</span></div><div class="line"><span class="section">test_vars:</span></div><div class="line">    @echo "\033[1;35;47mPrint variables...\033[0m"</div><div class="line">    @echo GYP_DIR=$(GYP_DIR)</div><div class="line">    @echo NDK_DIR=$(NDK_DIR)</div><div class="line">    @echo OUT_DIR=$(OUT_DIR)</div><div class="line">    @echo IOS_OUT=$(IOS_OUT)</div><div class="line">    @echo DEPS_DIR=$(DEPS_DIR)</div><div class="line">    @echo DEPS_DJINNI_DIR=$(DEPS_DJINNI_DIR)</div></pre></td></tr></table></figure>
<p>å…¶ä¹ŸåŒ…æ‹¬äº† Android å·¥ç¨‹çš„é…ç½®ã€‚</p>
<blockquote>
<p>æ³¨ï¼šé¢å¤–ä¾èµ–äº†ä¸¤ä¸ªè¾…åŠ©è„šæœ¬ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š<br><code>read_properties.sh</code>ï¼Œè¯»å–<code>local.properties</code>å†…é…ç½®çš„è·¯å¾„ã€‚<br><code>prepare_deps.sh</code>ï¼Œå‡†å¤‡ä¾èµ–çš„æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ã€‚</p>
</blockquote>
<p>ç„¶åï¼Œè¿è¡Œç”Ÿæˆ XCode çš„ libhellodjinni å·¥ç¨‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> project/</div><div class="line">$ make ios_pro</div></pre></td></tr></table></figure>
<p>å…¶ç”Ÿæˆåœ¨<code>project/build/ios</code>ç›®å½•ã€‚ XCode ç›´æ¥æ‰“å¼€<code>libhellodjinni.xcodeproj</code>ï¼Œå³å¯é€‰æ‹©ç›®æ ‡è¿›è¡Œç¼–è¯‘ã€‚</p>
<p>ä½†å¯èƒ½æ­¤æ—¶ libhellodjinni_jni ä¸ djinni_jni (support_lib) ç›®æ ‡ï¼Œä¸èƒ½å¤Ÿæ‰¾åˆ°<code>jni.h</code>ã€‚ç”±äº ios ä¸Šä¸éœ€è¦ jni ç»‘å®šï¼Œåç»­ä¹Ÿä¸éœ€ä¾èµ–ï¼Œæ²¡å¤šå¤§å½±å“ã€‚</p>
<p>ä¹Ÿè®©å…¶å¯é€šè¿‡ç¼–è¯‘çš„è¯ï¼Œåªéœ€è¦é€‰æ‹©ç›®æ ‡ï¼Œåœ¨â€Build Settings &gt; Header Search Pathsâ€å†…ï¼Œæ·»åŠ  Java VM include å°±å¥½ã€‚</p>
<p>è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè·å¾—å½“å‰çš„ Java å¤´æ–‡ä»¶è·¯å¾„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ls <span class="_">-l</span> `<span class="built_in">which</span> java` | sed <span class="string">'s/^.*-&gt; *\(.*Current\).*$/\1\/Headers/;q'</span></div></pre></td></tr></table></figure>
<p>ç»“æœï¼Œå¦‚ï¼šâ€/System/Library/Frameworks/JavaVM.framework/Versions/Current/Headersâ€ã€‚</p>
<p>æˆ–è€…ï¼Œè¿™é‡Œæ‰¾ï¼šâ€/Library/Java/JavaVirtualMachines/jdk1.8.0_25.jdk/Contents/Home/include/â€œã€‚</p>
<img src="/2016/05/06/using-djinni/ios_pro_lib_header.png" alt="ios_pro_lib_header.png" title="">
<h4 id="æ·»åŠ æ¥å£-Libraries-ä¾èµ–"><a href="#æ·»åŠ æ¥å£-Libraries-ä¾èµ–" class="headerlink" title="æ·»åŠ æ¥å£ Libraries ä¾èµ–"></a>æ·»åŠ æ¥å£ Libraries ä¾èµ–</h4><p>ç°åœ¨ï¼Œç»™ iOS å·¥ç¨‹ä¸Šæ·»åŠ ä¸Šæ¥å£ Libraries çš„ä¾èµ–ã€‚</p>
<p>é¦–å…ˆï¼Œæ‰“å¼€å…ˆå‰çš„å·¥ä½œåŒº<code>project/ios/HelloDjinni.xcworkspace</code>ã€‚äºå·¦ä¾§é¡¹ç›®å¯¼èˆªçš„ç°è‰²åŒºåŸŸï¼Œâ€Ctrl+Clickâ€æˆ–å³å‡»æ‰“å¼€èœå•ã€‚é€‰æ‹©â€Add Files to â€œHelloDjinniâ€â€ï¼Œæ·»åŠ ç”Ÿæˆå¥½çš„<code>libhellodjinni.xcodeproj</code>å’Œ<code>support_lib.xcodeproj</code>ä¸¤ä¸ªåº“å·¥ç¨‹ã€‚</p>
<p>ä¹‹åï¼Œé¡¹ç›®å¯¼èˆªé€‰ä¸­â€HelloDjinniâ€å·¥ç¨‹ï¼Œå¹¶é€‰æ‹©â€HelloDjinniâ€ç›®æ ‡ã€‚åœ¨â€Build Phasesâ€æ ‡ç­¾é¡µçš„â€Link Binaries With Librariesâ€é€‰é¡¹ä¸‹ï¼Œæ–°å¢ libhellodjinni_objc.a ä¸ libdjinni_objc.a çš„ä¾èµ–ï¼Œå¦‚ä¸‹ï¼š</p>
{% asset_img ios_pro_lib_link.png %}
<p>åœ¨â€Build Settingsâ€æ ‡ç­¾é¡µï¼Œæ‰¾åˆ°â€Header Search Pathsâ€ï¼Œæ·»åŠ å¤´æ–‡ä»¶æœç´¢è·¯å¾„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$(SRCROOT)/../../deps/djinni/support-lib/objc</div><div class="line">$(SRCROOT)/../../../generated-src/objc</div></pre></td></tr></table></figure>
<p>ä¸ºäº†å…¼å®¹ Objective-C++ æ¡¥æ¥ä»£ç ï¼Œéœ€è¦å°†<code>HelloWorld/Supporting Files/main.m</code>é‡å‘½åä¸º<code>main.mm</code>ã€‚</p>
<p>æœ€ç»ˆï¼Œå·¥ä½œåŒºä¼šç±»ä¼¼äºä¸‹é¢è¿™æ ·ï¼š</p>
{% asset_img ios_pro_overview.png %}
<h4 id="å®Œæˆ-UI-å¹¶è¿è¡Œ"><a href="#å®Œæˆ-UI-å¹¶è¿è¡Œ" class="headerlink" title="å®Œæˆ UI å¹¶è¿è¡Œ"></a>å®Œæˆ UI å¹¶è¿è¡Œ</h4><p>äº<code>ViewController.m</code>å†…ç¼–å†™ä»£ç ï¼Œåˆ›å»º UI å¹¶è°ƒç”¨æ¥å£ä»£ç ã€‚</p>
<figure class="highlight objc"><figcaption><span>project/ios/HelloDjinni/HelloDjinni/ViewController.m</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/ios/HelloDjinni/HelloDjinni/ViewController.m" target="_blank" rel="external">ViewController.m</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"ViewController.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"HDHelloDjinni.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span> </span>&#123;</div><div class="line">    HDHelloDjinni *_helloDjinniInterface;</div><div class="line">    <span class="built_in">UIButton</span> *_button;</div><div class="line">    <span class="built_in">UITextView</span> *_textView;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line"></div><div class="line">    <span class="comment">// instantiate our library interface</span></div><div class="line">    _helloDjinniInterface = [HDHelloDjinni create];</div><div class="line"></div><div class="line">    <span class="comment">// create a button programatically for the demo</span></div><div class="line">    _button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeRoundedRect</span>];</div><div class="line">    [_button addTarget:<span class="keyword">self</span></div><div class="line">                action:<span class="keyword">@selector</span>(buttonWasPressed:)</div><div class="line">      forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</div><div class="line">    [_button setTitle:<span class="string">@"Get Hello Djinni!"</span> forState:<span class="built_in">UIControlStateNormal</span>];</div><div class="line">    _button.frame = <span class="built_in">CGRectMake</span>(<span class="number">20.0</span>, <span class="number">20.0</span>, <span class="number">280.0</span>, <span class="number">40.0</span>);</div><div class="line">    [<span class="keyword">self</span>.view addSubview:_button];</div><div class="line"></div><div class="line">    <span class="comment">// create a text view programatically</span></div><div class="line">    _textView = [[<span class="built_in">UITextView</span> alloc] init];</div><div class="line">    <span class="comment">// x, y, width, height</span></div><div class="line">    _textView.frame = <span class="built_in">CGRectMake</span>(<span class="number">20.0</span>, <span class="number">80.0</span>, <span class="number">280.0</span>, <span class="number">380.0</span>);</div><div class="line">    [<span class="keyword">self</span>.view addSubview:_textView];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)buttonWasPressed:(<span class="built_in">UIButton</span> *)sender &#123;</div><div class="line">    <span class="built_in">NSString</span> *response = [_helloDjinniInterface getHelloDjinni];</div><div class="line">    _textView.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@\n%@"</span>, response, _textView.text];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)didReceiveMemoryWarning &#123;</div><div class="line">    [<span class="keyword">super</span> didReceiveMemoryWarning];</div><div class="line">    <span class="comment">// Dispose of any resources that can be recreated.</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>â€œProduct &gt; Runâ€è¿è¡Œé¡¹ç›®ã€‚ UI ä¸Šâ€Get Hello Djinni!â€çš„æŒ‰é’®ï¼Œæ¯ç‚¹å‡»ä¸‹å°±ä¼šæ·»åŠ æ¡ä» C++ è¿”å›çš„ä¿¡æ¯ã€‚</p>
<img src="/2016/05/06/using-djinni/ios_pro_result.png" width="300">
<h3 id="Android-å·¥ç¨‹"><a href="#Android-å·¥ç¨‹" class="headerlink" title="Android å·¥ç¨‹"></a>Android å·¥ç¨‹</h3><p>Android å·¥ç¨‹ä»‹ç»äº†ä¸¤ç§æ–¹å¼ï¼Œæ¥æ•´åˆ NDK Library ï¼š</p>
<ul>
<li>ä¸€æ˜¯ï¼Œä½¿ç”¨ GYP ç”Ÿæˆçš„ Android Makefile ï¼Œ Gradle é…ç½® ndk-build è¿›è¡Œç¼–è¯‘ã€‚</li>
<li>äºŒæ˜¯ï¼Œä½¿ç”¨ Experimental Plugin ï¼Œç›´æ¥é…ç½®æˆæ”¯æŒ NDK çš„å·¥ç¨‹ã€‚</li>
</ul>
<h4 id="ä½¿ç”¨-GypMakefile"><a href="#ä½¿ç”¨-GypMakefile" class="headerlink" title="ä½¿ç”¨ GypMakefile"></a>ä½¿ç”¨ GypMakefile</h4><p>GYP ç”Ÿæˆ Android Makefile ï¼Œä½¿ç”¨ä¹‹å‰å†™å¥½çš„<code>project/Makefile</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> project/</div><div class="line">$ make android_pro</div></pre></td></tr></table></figure>
<p><code>GypAndroid.mk</code>ä¼šç”Ÿæˆåˆ°çˆ¶çº§<code>hellodjinni</code>ç›®å½•ã€‚</p>
<p>å¦‚æœè¿˜æ²¡å‡†å¤‡å¥½ Studio å·¥ç¨‹ï¼Œä¸ä¼šç»§ç»­ç”Ÿæˆ APK ï¼Œä¼šæŠ¥â€œæ‰¾ä¸åˆ°<code>android/HelloDjinni/</code>â€ã€‚</p>
<p>ç°åœ¨ï¼Œæ‰“å¼€ Android Studioï¼Œé€‰æ‹©â€Start a new Android Studio Projectâ€ã€‚</p>
<p>â€œNewâ€é¡µï¼Œâ€Project Locationâ€å­˜åˆ°<code>project/android/HelloDjinni</code>ï¼Œå¦‚ä¸‹ï¼š</p>
{% asset_img android_pro_new.png %}
<p>ä¹‹åï¼Œâ€Targetâ€é¡µé€‰â€Phone and Tabletâ€ï¼Œâ€Addâ€é¡µé€‰â€Empty Activityâ€ï¼Œæœ€ç»ˆå®Œæˆæ–°å»ºã€‚</p>
<p>äºâ€File &gt; Project Structure &gt; SDK Location &gt; Android NDK Locationâ€ï¼Œè®¾ç½® NDK è·¯å¾„ï¼š</p>
{% asset_img android_pro_sdk.png %}
<p>æ¥ä¸‹æ¥ï¼Œç‹¬ç«‹å»ºä¸€ä¸ª app-core Library æ¨¡å—æ¥å¼•ç”¨ C++ ä»£ç ã€‚â€File &gt; New Moduleâ€ï¼Œé€‰â€Android Libraryâ€ï¼š</p>
{% asset_img android_pro_new_lib.png %}
<p>ç„¶åï¼Œä¿®æ”¹æ­¤ app-core çš„<code>build.gradle</code>ï¼Œæ·»åŠ å¼•ç”¨åŠ NDK ç¼–è¯‘ã€‚å˜æ›´å¦‚ä¸‹ï¼š</p>
<figure class="highlight gradle"><figcaption><span>project/android/HelloDjinni/app-core/build.gradle</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni/app-core/build.gradle" target="_blank" rel="external">build.gradle</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.library'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">sourceSets</span> &#123;</div><div class="line">        main &#123;</div><div class="line">            java.srcDirs += [<span class="string">'../../../../generated-src/java'</span>]</div><div class="line">            jni.srcDirs = []</div><div class="line">            jniLibs.srcDirs = [<span class="string">'libs'</span>]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    ...</div><div class="line">    <span class="comment">//compile 'com.android.support:appcompat-v7:23.3.0'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">task</span> ndkBuild(type: Exec) &#123;</div><div class="line">    <span class="keyword">def</span> ndkDir = plugins.getPlugin(<span class="string">'com.android.library'</span>).sdkHandler.ndkFolder</div><div class="line">    <span class="keyword">if</span> (ndkDir == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">def</span> gradle_project_root = <span class="keyword">project</span>.rootProject.rootDir</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GradleException(<span class="string">"NDK is not configured. Make sure there is a local.properties "</span> +</div><div class="line">                <span class="string">"file with an ndk.dir entry in the directory $&#123;gradle_project_root&#125;."</span>)</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">def</span> ndkBuildExecutable = <span class="keyword">new</span> <span class="keyword">File</span>(ndkDir, <span class="string">'ndk-build'</span>)</div><div class="line">    <span class="keyword">if</span> (!ndkBuildExecutable.exists()) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GradleException(<span class="string">"Could not find ndk-build. The configured NDK directory $&#123;ndkDir&#125; may not be correct."</span>)</div><div class="line">    &#125;</div><div class="line">    environment(<span class="string">"NDK_PROJECT_PATH"</span>, projectDir)</div><div class="line">    environment(<span class="string">"GYP_CONFIGURATION"</span>, <span class="string">"Release"</span>)</div><div class="line">    commandLine ndkBuildExecutable</div><div class="line">&#125;</div><div class="line"></div><div class="line">tasks.withType(JavaCompile) &#123;</div><div class="line">    compileTask -&gt; compileTask.dependsOn ndkBuild</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é¡¹ç›®å¯¼èˆªæ åˆ‡åˆ° Project è§†å›¾ï¼Œåœ¨ app-core ä¸‹æ–°å»º<code>jni</code>ç›®å½•ï¼Œåˆ›å»º NDK çš„å·¥ç¨‹æ–‡ä»¶ã€‚</p>
<figure class="highlight makefile"><figcaption><span>project/android/HelloDjinni/app-core/jni/Android.mk</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni/app-core/jni/Android.mk" target="_blank" rel="external">Android.mk</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># always force this build to re-run its dependencies</span></div><div class="line">FORCE_GYP := <span class="variable">$(shell make -C ../../../../ GypAndroid.mk)</span></div><div class="line">include ../../../../GypAndroid.mk</div></pre></td></tr></table></figure>
<figure class="highlight makefile"><figcaption><span>project/android/HelloDjinni/app-core/jni/Application.mk</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni/app-core/jni/Application.mk" target="_blank" rel="external">Application.mk</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Android makefile for libhellodjinni shared lib</span></div><div class="line"></div><div class="line"><span class="comment"># Application.mk: http://developer.android.com/ndk/guides/application_mk.html</span></div><div class="line"></div><div class="line"><span class="comment"># APP_ABI := all</span></div><div class="line"><span class="comment"># skipping mips / mips64</span></div><div class="line">APP_ABI := armeabi armeabi-v7a arm64-v8a x86 x86_64</div><div class="line">APP_OPTIM := release</div><div class="line">APP_PLATFORM := android-14</div><div class="line"><span class="comment"># GCC 4.9 Toolchain - requires NDK r10</span></div><div class="line">NDK_TOOLCHAIN_VERSION = 4.9</div><div class="line"><span class="comment"># GNU libc++ is the only Android STL which supports C++11 features</span></div><div class="line">APP_CFLAGS += -Wall</div><div class="line">APP_CPPFLAGS += -std=c++11 -frtti -fexceptions</div><div class="line">APP_STL := gnustl_static</div><div class="line">APP_BUILD_SCRIPT := jni/Android.mk</div><div class="line">APP_MODULES := libhellodjinni_jni</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œç‹¬ç«‹çš„ app-core Library å°±ğŸ‘Œäº†ã€‚</p>
<p>å›åˆ° app ï¼Œä¿®æ”¹å…¶<code>build.gradle</code>ï¼Œä»¥ä¾èµ– app-core ã€‚å˜æ›´å¦‚ä¸‹ï¼š</p>
<figure class="highlight gradle"><figcaption><span>project/android/HelloDjinni/app/build.gradle</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni/app/build.gradle" target="_blank" rel="external">build.gradle</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">compile</span> <span class="keyword">project</span>(<span class="string">':app-core'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ–°å»º<code>MyApplication.java</code>ï¼Œä½œä¸ºè‡ªå®šä¹‰ Applicationã€‚å¹¶è®¾ç½®åˆ°<code>AndroidManifest.xml</code>å†…â€applicationâ€çš„â€nameâ€å­—æ®µã€‚</p>
<figure class="highlight java"><figcaption><span>project/android/HelloDjinni/app/src/.../MyApplication.java</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni/app/src/main/java/cc/eevee/hellodjinni/MyApplication.java" target="_blank" rel="external">MyApplication.java</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cc.eevee.hellodjinni;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Application;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            System.loadLibrary(<span class="string">"hellodjinni_jni"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (UnsatisfiedLinkError e) &#123;</div><div class="line">            System.err.println(<span class="string">"Native code library failed to load.\n"</span> + e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€ç»ˆï¼Œé¡¹ç›®å¯¼èˆª Android å’Œ Project è§†å›¾ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š</p>
{% asset_img android_pro_nav.png %}
<p>æ¥ç€ï¼Œä¿®æ”¹ app UIï¼Œ<code>MainActivity.java</code>åŠå…¶å¸ƒå±€<code>activity_main.xml</code>ï¼š</p>
<figure class="highlight java"><figcaption><span>project/android/HelloDjinni/app/src/.../MainActivity.java</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni/app/src/main/java/cc/eevee/hellodjinni/MainActivity.java" target="_blank" rel="external">MainActivity.java</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cc.eevee.hellodjinni;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.ScrollView;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> TextView mTextView;</div><div class="line">    <span class="keyword">private</span> ScrollView mScrollView;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> HelloDjinni mHelloDjinniInterface = HelloDjinni.create();</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mTextView = (TextView) findViewById(R.id.textView);</div><div class="line">        mScrollView = (ScrollView) findViewById(R.id.scrollView);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onButtonClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        mTextView.append(mHelloDjinniInterface.getHelloDjinni() + <span class="string">"\n"</span>);</div><div class="line">        mScrollView.fullScroll(ScrollView.FOCUS_DOWN);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><figcaption><span>project/android/HelloDjinni/app/src/.../activity_main.xml</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni/app/src/main/res/layout/activity_main.xml" target="_blank" rel="external">activity_main.xml</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">    <span class="attr">android:paddingBottom</span>=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    <span class="attr">android:paddingLeft</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"cc.eevee.hellodjinni.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/button"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"Get Hello Djinni!"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:onClick</span>=<span class="string">"onButtonClick"</span>/&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ScrollView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/scrollView"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/textView"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>â€œRun &gt; Run â€˜appâ€™â€è¿è¡Œé¡¹ç›®ã€‚ UI ä¸Šâ€Get Hello Djinni!â€çš„æŒ‰é’®ï¼Œæ¯ç‚¹å‡»ä¸‹å°±ä¼šæ·»åŠ æ¡ä» C++ è¿”å›çš„ä¿¡æ¯ã€‚</p>
{% img /2016/05/06/using-djinni/android_pro_result.png 300 %}
<h4 id="ä½¿ç”¨æ–°è¯•éªŒæ€§æ’ä»¶"><a href="#ä½¿ç”¨æ–°è¯•éªŒæ€§æ’ä»¶" class="headerlink" title="ä½¿ç”¨æ–°è¯•éªŒæ€§æ’ä»¶"></a>ä½¿ç”¨æ–°è¯•éªŒæ€§æ’ä»¶</h4><p>Android Studio 1.3 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ NDKï¼Œéœ€è¦ä½¿ç”¨ Experimental Plugin ã€‚è¿™é‡Œä¸ºå½“å‰æœ€æ–°çš„ 0.7.0 ç‰ˆæœ¬ã€‚</p>
<p>åŒæ ·ï¼Œæ‰“å¼€ Android Studioï¼Œé€‰æ‹©â€Start a new Android Studio Projectâ€ï¼Œæ–°å»ºä¸€ä¸ªâ€HelloDjinni2â€å·¥ç¨‹ã€‚</p>
{% asset_img android_pro2_new.png %}
<p>ä¹‹åï¼Œâ€Targetâ€é¡µé€‰â€Phone and Tabletâ€ï¼Œâ€Addâ€é¡µé€‰â€Empty Activityâ€ï¼Œæœ€ç»ˆå®Œæˆæ–°å»ºã€‚</p>
<p>äºâ€File &gt; Project Structure &gt; SDK Location &gt; Android NDK Locationâ€ï¼Œè®¾ç½® NDK è·¯å¾„ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä¿®æ”¹æˆ Experimental Plugin ã€‚å…ˆæ˜¯å·¥ç¨‹é…ç½®ï¼š</p>
<figure class="highlight gradle"><figcaption><span>project/android/HelloDjinni2/build.gradle</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni2/build.gradle" target="_blank" rel="external">build.gradle</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></div><div class="line"></div><div class="line"><span class="keyword">buildscript</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle-experimental:0.7.0'</span></div><div class="line"></div><div class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></div><div class="line">        <span class="comment">// in the individual module build.gradle files</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">allprojects</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">task</span> clean(type: <span class="keyword">Delete</span>) &#123;</div><div class="line">    <span class="keyword">delete</span> rootProject.buildDir</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ¥ç€æ˜¯ app æ¨¡å—é…ç½®ï¼š</p>
<figure class="highlight gradle"><figcaption><span>project/android/HelloDjinni2/app/build.gradle</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni2/app/build.gradle" target="_blank" rel="external">build.gradle</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.model.application'</span></div><div class="line"></div><div class="line">model &#123;</div><div class="line">    android &#123;</div><div class="line">        compileSdkVersion = <span class="number">23</span></div><div class="line">        buildToolsVersion = <span class="string">'23.0.3'</span></div><div class="line"></div><div class="line">        defaultConfig &#123;</div><div class="line">            applicationId = <span class="string">'cc.eevee.hellodjinni2'</span></div><div class="line">            minSdkVersion.apiLevel    = <span class="number">14</span></div><div class="line">            targetSdkVersion.apiLevel = <span class="number">23</span></div><div class="line">            versionCode = <span class="number">1</span></div><div class="line">            versionName = <span class="string">'1.0'</span></div><div class="line">        &#125;</div><div class="line">        buildTypes &#123;</div><div class="line">            release &#123;</div><div class="line">                minifyEnabled = <span class="keyword">false</span></div><div class="line">                proguardFiles.add(<span class="keyword">file</span>(<span class="string">'proguard-rules.pro'</span>))</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</div><div class="line">    testCompile <span class="string">'junit:junit:4.12'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:23.3.0'</span></div><div class="line">    <span class="comment">//compile project(':app-core')</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œ Experimental Plugin å°±ä¿®æ”¹å®Œæˆäº†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä»æ—§ç‹¬ç«‹å»ºä¸€ä¸ª app-core Library æ¨¡å—æ¥å¼•ç”¨ C++ ä»£ç ã€‚â€File &gt; New Moduleâ€ï¼Œé€‰â€Android Libraryâ€ï¼š</p>
{% asset_img android_pro2_new_lib.png %}
<p>ç„¶åï¼Œä¿®æ”¹æ­¤ app-core çš„<code>build.gradle</code>ï¼Œæ”¯æŒ Experimental Plugin å¹¶é…ç½® NDK ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight gradle"><figcaption><span>project/android/HelloDjinni2/app-core/build.gradle</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni2/app-core/build.gradle" target="_blank" rel="external">build.gradle</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.model.library'</span></div><div class="line"></div><div class="line">model &#123;</div><div class="line">    android &#123;</div><div class="line">        compileSdkVersion = <span class="number">23</span></div><div class="line">        buildToolsVersion = <span class="string">'23.0.3'</span></div><div class="line"></div><div class="line">        defaultConfig &#123;</div><div class="line">            minSdkVersion.apiLevel    = <span class="number">14</span></div><div class="line">            targetSdkVersion.apiLevel = <span class="number">23</span></div><div class="line">        &#125;</div><div class="line">        ndk &#123;</div><div class="line">            moduleName = <span class="string">'hellodjinni'</span></div><div class="line">            platformVersion = <span class="number">14</span></div><div class="line">            toolchain = <span class="string">'gcc'</span></div><div class="line">            toolchainVersion = <span class="string">'4.9'</span></div><div class="line">            stl = <span class="string">'gnustl_shared'</span></div><div class="line">            CFlags.addAll([<span class="string">'-Wall'</span>, <span class="string">'-Werror'</span>])</div><div class="line">            cppFlags.addAll([<span class="string">'-std=c++11'</span>, <span class="string">'-fexceptions'</span>, <span class="string">'-frtti'</span>])</div><div class="line">            cppFlags.addAll([</div><div class="line">                    <span class="string">"-I$&#123;file('../../../deps/djinni/support-lib')&#125;"</span>.toString(),</div><div class="line">                    <span class="string">"-I$&#123;file('../../../deps/djinni/support-lib/jni')&#125;"</span>.toString(),</div><div class="line">                    <span class="string">"-I$&#123;file('../../../../generated-src/cpp')&#125;"</span>.toString(),</div><div class="line">                    <span class="string">"-I$&#123;file('../../../../generated-src/jni')&#125;"</span>.toString(),</div><div class="line">            ])</div><div class="line">            ldLibs.addAll([<span class="string">'log'</span>])</div><div class="line">            abiFilters.addAll([<span class="string">'armeabi'</span>, <span class="string">'armeabi-v7a'</span>, <span class="string">'arm64-v8a'</span>, <span class="string">'x86'</span>, <span class="string">'x86_64'</span>])</div><div class="line">        &#125;</div><div class="line">        sources &#123;</div><div class="line">            <span class="comment">//noinspection GroovyAssignabilityCheck</span></div><div class="line">            main &#123;</div><div class="line">                jni &#123;</div><div class="line">                    <span class="keyword">source</span> &#123;</div><div class="line">                        srcDirs += [</div><div class="line">                            <span class="string">'../../../deps/djinni/support-lib/jni'</span>,</div><div class="line">                            <span class="string">'../../../../generated-src/cpp'</span>,</div><div class="line">                            <span class="string">'../../../../generated-src/jni'</span>,</div><div class="line">                            <span class="string">'../../../../src/cpp'</span>,</div><div class="line">                        ]</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                java &#123;</div><div class="line">                    <span class="keyword">source</span> &#123;</div><div class="line">                        srcDirs += [</div><div class="line">                            <span class="string">'../../../../generated-src/java'</span>,</div><div class="line">                        ]</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        buildTypes &#123;</div><div class="line">            release &#123;</div><div class="line">                minifyEnabled = <span class="keyword">false</span></div><div class="line">                proguardFiles.add(<span class="keyword">file</span>(<span class="string">'proguard-rules.pro'</span>))</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</div><div class="line">    testCompile <span class="string">'junit:junit:4.12'</span></div><div class="line">    <span class="comment">//compile 'com.android.support:appcompat-v7:23.3.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·ä¹‹åï¼Œå¯ä»¥åœ¨ app-core ä¸‹çœ‹å¾—<code>jni</code>ç›®å½•ï¼ŒåŒ…æ‹¬äº†æ‰€æœ‰ C++ ä»£ç ã€‚</p>
<p>å›åˆ° app ï¼Œä¿®æ”¹å…¶<code>build.gradle</code>ï¼Œä»¥ä¾èµ– app-core ã€‚å˜æ›´å¦‚ä¸‹ï¼š</p>
<figure class="highlight gradle"><figcaption><span>project/android/HelloDjinni2/app/build.gradle</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni2/app/build.gradle" target="_blank" rel="external">build.gradle</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">compile</span> <span class="keyword">project</span>(<span class="string">':app-core'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ–°å»º<code>MyApplication.java</code>ï¼Œä½œä¸ºè‡ªå®šä¹‰ Applicationã€‚å¹¶è®¾ç½®åˆ°<code>AndroidManifest.xml</code>å†…â€applicationâ€çš„â€nameâ€å­—æ®µã€‚</p>
<figure class="highlight java"><figcaption><span>project/android/HelloDjinni2/app/src/.../MyApplication.java</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni2/app/src/main/java/cc/eevee/hellodjinni2/MyApplication.java" target="_blank" rel="external">MyApplication.java</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cc.eevee.hellodjinni2;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Application;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            System.loadLibrary(<span class="string">"gnustl_shared"</span>);</div><div class="line">            System.loadLibrary(<span class="string">"hellodjinni"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (UnsatisfiedLinkError e) &#123;</div><div class="line">            System.err.println(<span class="string">"Native code library failed to load.\n"</span> + e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ€ç»ˆï¼Œé¡¹ç›®å¯¼èˆª Android å’Œ Project è§†å›¾ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š</p>
{% asset_img android_pro2_nav.png %}
<p>æ¥ç€ï¼Œä¿®æ”¹ app UIï¼Œ<code>MainActivity.java</code>åŠå…¶å¸ƒå±€<code>activity_main.xml</code>ï¼š</p>
<figure class="highlight java"><figcaption><span>project/android/HelloDjinni2/app/src/.../MainActivity.java</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni2/app/src/main/java/cc/eevee/hellodjinni2/MainActivity.java" target="_blank" rel="external">MainActivity.java</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cc.eevee.hellodjinni2;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.ScrollView;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cc.eevee.hellodjinni.HelloDjinni;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> TextView mTextView;</div><div class="line">    <span class="keyword">private</span> ScrollView mScrollView;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> HelloDjinni mHelloDjinniInterface = HelloDjinni.create();</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mTextView = (TextView) findViewById(R.id.textView);</div><div class="line">        mScrollView = (ScrollView) findViewById(R.id.scrollView);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onButtonClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        mTextView.append(mHelloDjinniInterface.getHelloDjinni() + <span class="string">"\n"</span>);</div><div class="line">        mScrollView.fullScroll(ScrollView.FOCUS_DOWN);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><figcaption><span>project/android/HelloDjinni2/app/src/.../activity_main.xml</span><a href="https://github.com/joinAero/XCalculator/tree/master/sample/hellodjinni/project/android/HelloDjinni2/app/src/main/res/layout/activity_main.xml" target="_blank" rel="external">activity_main.xml</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">    <span class="attr">android:paddingBottom</span>=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    <span class="attr">android:paddingLeft</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"cc.eevee.hellodjinni2.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/button"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"Get Hello Djinni!"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:onClick</span>=<span class="string">"onButtonClick"</span>/&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ScrollView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/scrollView"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/textView"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>â€œRun &gt; Run â€˜appâ€™â€è¿è¡Œé¡¹ç›®ã€‚ UI ä¸Šâ€Get Hello Djinni!â€çš„æŒ‰é’®ï¼Œæ¯ç‚¹å‡»ä¸‹å°±ä¼šæ·»åŠ æ¡ä» C++ è¿”å›çš„ä¿¡æ¯ã€‚</p>
{% img /2016/05/06/using-djinni/android_pro2_result.png 300 %}
<h4 id="NDK-å‚è€ƒ"><a href="#NDK-å‚è€ƒ" class="headerlink" title="NDK å‚è€ƒ"></a>NDK å‚è€ƒ</h4><ul>
<li><a href="http://developer.android.com/ndk/guides/index.html" target="_blank" rel="external">NDK Guides</a></li>
<li><a href="http://tools.android.com/tech-docs/android-ndk-preview" target="_blank" rel="external">Android NDK Preview</a></li>
<li><a href="http://tools.android.com/tech-docs/new-build-system/gradle-experimental" target="_blank" rel="external">Experimental Plugin User Guide</a></li>
<li><a href="http://stackoverflow.com/questions/31979965/after-updating-android-studio-to-version-1-3-0-i-am-getting-ndk-integration-is" target="_blank" rel="external">Error: NDK integration is deprecated in the current plugin</a></li>
</ul>
<h2 id="ç»“è¯­ï¼šå¼€å§‹ä½¿ç”¨-Djinni-å§"><a href="#ç»“è¯­ï¼šå¼€å§‹ä½¿ç”¨-Djinni-å§" class="headerlink" title="ç»“è¯­ï¼šå¼€å§‹ä½¿ç”¨ Djinni å§"></a>ç»“è¯­ï¼šå¼€å§‹ä½¿ç”¨ Djinni å§</h2><h2 id="é™„ï¼šæºç "><a href="#é™„ï¼šæºç " class="headerlink" title="é™„ï¼šæºç "></a>é™„ï¼šæºç </h2><p>Hello Djinni çš„æºç ï¼Œè¿™æ ·å¾—åˆ°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/joinAero/XCalculator.git</div><div class="line">$ <span class="built_in">cd</span> sample/hellodjinni/</div></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>local.properties</code>è®¾å¥½ç¯å¢ƒã€‚æ‰§è¡Œ<code>make</code>ç¼–è¯‘ï¼Œ<code>make clean</code>æ¸…ç†ã€‚</p>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">hellodjinni/</div><div class="line">â”œâ”€project/</div><div class="line">â”‚  â”œâ”€android/</div><div class="line">â”‚  â”‚  â”œâ”€HelloDjinni/                # Android Project with GYP &amp; ndk-build</div><div class="line">â”‚  â”‚  â””â”€HelloDjinni2/               # Android Project with Experimental Plugin</div><div class="line">â”‚  â”œâ”€cpp/</div><div class="line">â”‚  â”‚  â””â”€HelloDjinni/                # Cpp Test Project</div><div class="line">â”‚  â””â”€ios/</div><div class="line">â”‚      â”œâ”€HelloDjinni/</div><div class="line">â”‚      â””â”€HelloDjinni.xcworkspace/   # iOS Project Workspace</div><div class="line">â”œâ”€src/</div><div class="line">â”‚  â””â”€cpp/                           # Cpp Interface Impls</div><div class="line">â”œâ”€tools/                            # Helper Scripts</div><div class="line">â””â”€local.properties                  # Local Properties</div></pre></td></tr></table></figure>
<h2 id="é™„ï¼šè¿è¡Œç¯å¢ƒ"><a href="#é™„ï¼šè¿è¡Œç¯å¢ƒ" class="headerlink" title="é™„ï¼šè¿è¡Œç¯å¢ƒ"></a>é™„ï¼šè¿è¡Œç¯å¢ƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># OS</span></div><div class="line">ProductName: Mac OS X ProductVersion: 10.11.4 BuildVersion: 15E65</div><div class="line"></div><div class="line"><span class="comment"># XCode</span></div><div class="line">Xcode 7.3.1 Build version 7D1014</div><div class="line"></div><div class="line"><span class="comment"># XCode å‘½ä»¤è¡Œå·¥å…·</span></div><div class="line"><span class="comment"># xcode-select --install</span></div><div class="line">xcode-select version 2343.</div><div class="line"></div><div class="line"><span class="comment"># Java</span></div><div class="line">java version <span class="string">"1.8.0_25"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_25-b17)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.25-b02, mixed mode)</div><div class="line"></div><div class="line"><span class="comment"># Android Studio</span></div><div class="line"><span class="comment"># Android Studio &gt; About Android Studio</span></div><div class="line"><span class="comment"># Android Studio &gt; Appearance &amp; Behavior &gt; System Settings &gt; Updates</span></div><div class="line">Android Studio 2.1</div><div class="line">Build <span class="comment">#AI-143.2790544</span></div><div class="line"></div><div class="line"><span class="comment"># Android NDK</span></div><div class="line">GNU Make 3.81 Copyright (C) 2006 Free Software Foundation, Inc. This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions. There is NO warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. This program built <span class="keyword">for</span> i386-apple-darwin11.3.0</div></pre></td></tr></table></figure>
<p>å¦‚æœæœªæ·»åŠ è¿‡ Android ç¯å¢ƒå˜é‡ï¼Œè¯·äº ~/.bash_profile æ–‡ä»¶å†…è®¾ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> ANDROID_HOME=<span class="variable">$HOME</span>/Develop/android-sdk</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ANDROID_HOME</span>/tools:<span class="variable">$ANDROID_HOME</span>/platform-tools</div><div class="line"></div><div class="line"><span class="built_in">export</span> ANDROID_NDK_HOME=<span class="variable">$HOME</span>/Develop/android-ndk</div><div class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ANDROID_NDK_HOME</span></div></pre></td></tr></table></figure>
<p>ç»ˆç«¯è¿è¡Œå¦‚ä¸‹å‘½ä»¤å¯ç«‹å³ç”Ÿæ•ˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">source</span> ~/.bash_profile</div></pre></td></tr></table></figure>
<p>éªŒè¯ SDK ä¸ NDK å‘½ä»¤è¡Œå·¥å…·å¯ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">which</span> android</div><div class="line"></div><div class="line">$ <span class="built_in">which</span> ndk-build</div></pre></td></tr></table></figure>
<p>éªŒè¯ XCode å‘½ä»¤è¡Œå·¥å…·å¯ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">which</span> xcrun</div><div class="line"></div><div class="line">$ <span class="built_in">which</span> xcodebuild</div></pre></td></tr></table></figure>
<h2 id="é™„ï¼šå‚è€ƒå†…å®¹"><a href="#é™„ï¼šå‚è€ƒå†…å®¹" class="headerlink" title="é™„ï¼šå‚è€ƒå†…å®¹"></a>é™„ï¼šå‚è€ƒå†…å®¹</h2><ul>
<li><a href="http://mobilecpptutorials.com/your-first-cross-platform-djinni-app-part-1-cplusplus/" target="_blank" rel="external">Your First Cross-Platform Djinni App</a></li>
<li><a href="http://www.infoq.com/cn/news/2014/06/dropbox-cpp-crossplatform-mobile/" target="_blank" rel="external">iOSå’ŒAndroidçš„C++è·¨å¹³å°å¼€å‘ | Dropbox</a></li>
</ul>
<!--
Projects:

* [djinni | dropbox](https://github.com/dropbox/djinni)
* [android-ndk | googlesamples](https://github.com/googlesamples/android-ndk.git)

References:

* [Cpp Reference](http://en.cppreference.com)
* [NDK API Reference](http://developer.android.com/ndk/reference/index.html)
* [iOS Developer Library](https://developer.apple.com/library/ios)
* [Mac Developer Library](https://developer.apple.com/library/mac)

Extra Articles:

* [From C++ to Objective-C](http://pierre.chachatelier.fr/programmation/fichiers/cpp-objc-2_1-en.pdf)

Extra Tools:

* [sbt](http://www.scala-sbt.org/index.html): `brew install sbt`
* [sbtä¸‹è½½æ…¢ï¼Ÿ](http://www.zhihu.com/question/31158252)
-->

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div><div style="display: table; margin: 0 auto"> <span style="display: table-cell; vertical-align: middle">æ‚¨å¯ä»¥æŠ•é£Ÿå°ä¼Šå¸ƒ</span> <img src="/uploads/avatar.png" style="display: table-cell; width: 30px; margin-bottom: 10px" /> <span style="display: table-cell; vertical-align: middle">ï¼Œå¥–åŠ±ä¸€ä¸‹å“¦~</span> </div></div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>èµ</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/uploads/wechat-reward-qrcode.png" alt="Eevee WeChat Pay"/>
          <p>å¾®ä¿¡æ‰“èµ</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/uploads/alipay-reward-qrcode.jpg" alt="Eevee Alipay"/>
          <p>æ”¯ä»˜å®æ‰“èµ</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
      Eevee
    </li>
    <li class="post-copyright-link">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="http://eevee.cc/2016/05/06/using-djinni/" title="ä½¿ç”¨ Djinni å¼€å‘ Android, iOS å…±äº«åº“">http://eevee.cc/2016/05/06/using-djinni/</a>
    </li>
    <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
      æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-ND 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Djinni/" rel="tag"># Djinni</a>
          
            <a href="/tags/Cpp/" rel="tag"># Cpp</a>
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/04/12/install-caffe-tf/" rel="prev" title="Install Caffe & TensorFlow with Python and CUDA (macOS)">
                Install Caffe & TensorFlow with Python and CUDA (macOS) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="Eevee" />
          <p class="site-author-name" itemprop="name">Eevee</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/joinAero" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/joinAero" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆè§ï¼šDjinni-åŠå…¶æ ·ä¾‹"><span class="nav-number">1.</span> <span class="nav-text">åˆè§ï¼šDjinni åŠå…¶æ ·ä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸‹è½½-Djinni"><span class="nav-number">1.1.</span> <span class="nav-text">ä¸‹è½½ Djinni</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç¼–è¯‘-Djinni"><span class="nav-number">1.2.</span> <span class="nav-text">ç¼–è¯‘ Djinni</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨-Djinni"><span class="nav-number">1.3.</span> <span class="nav-text">ä½¿ç”¨ Djinni</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç¼–è¯‘æ ·ä¾‹"><span class="nav-number">1.4.</span> <span class="nav-text">ç¼–è¯‘æ ·ä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‡†å¤‡-GYP"><span class="nav-number">1.5.</span> <span class="nav-text">å‡†å¤‡ GYP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»æ— åˆ°æœ‰ï¼šHello-Djinni"><span class="nav-number">2.</span> <span class="nav-text">ä»æ— åˆ°æœ‰ï¼šHello Djinni</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#C-æ¥å£"><span class="nav-number">2.1.</span> <span class="nav-text">C++ æ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å®šä¹‰æ¥å£æè¿°æ–‡ä»¶"><span class="nav-number">2.1.1.</span> <span class="nav-text">å®šä¹‰æ¥å£æè¿°æ–‡ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç”Ÿæˆæ¥å£ç»‘å®šä»£ç "><span class="nav-number">2.1.2.</span> <span class="nav-text">ç”Ÿæˆæ¥å£ç»‘å®šä»£ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å®ç°-C-æ¥å£"><span class="nav-number">2.1.3.</span> <span class="nav-text">å®ç° C++ æ¥å£</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-å·¥ç¨‹"><span class="nav-number">2.2.</span> <span class="nav-text">C++ å·¥ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iOS-å·¥ç¨‹"><span class="nav-number">2.3.</span> <span class="nav-text">iOS å·¥ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç”Ÿæˆæ¥å£-Libraries-å·¥ç¨‹"><span class="nav-number">2.3.1.</span> <span class="nav-text">ç”Ÿæˆæ¥å£ Libraries å·¥ç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ·»åŠ æ¥å£-Libraries-ä¾èµ–"><span class="nav-number">2.3.2.</span> <span class="nav-text">æ·»åŠ æ¥å£ Libraries ä¾èµ–</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å®Œæˆ-UI-å¹¶è¿è¡Œ"><span class="nav-number">2.3.3.</span> <span class="nav-text">å®Œæˆ UI å¹¶è¿è¡Œ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android-å·¥ç¨‹"><span class="nav-number">2.4.</span> <span class="nav-text">Android å·¥ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ä½¿ç”¨-GypMakefile"><span class="nav-number">2.4.1.</span> <span class="nav-text">ä½¿ç”¨ GypMakefile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä½¿ç”¨æ–°è¯•éªŒæ€§æ’ä»¶"><span class="nav-number">2.4.2.</span> <span class="nav-text">ä½¿ç”¨æ–°è¯•éªŒæ€§æ’ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NDK-å‚è€ƒ"><span class="nav-number">2.4.3.</span> <span class="nav-text">NDK å‚è€ƒ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç»“è¯­ï¼šå¼€å§‹ä½¿ç”¨-Djinni-å§"><span class="nav-number">3.</span> <span class="nav-text">ç»“è¯­ï¼šå¼€å§‹ä½¿ç”¨ Djinni å§</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é™„ï¼šæºç "><span class="nav-number">4.</span> <span class="nav-text">é™„ï¼šæºç </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é™„ï¼šè¿è¡Œç¯å¢ƒ"><span class="nav-number">5.</span> <span class="nav-text">é™„ï¼šè¿è¡Œç¯å¢ƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é™„ï¼šå‚è€ƒå†…å®¹"><span class="nav-number">6.</span> <span class="nav-text">é™„ï¼šå‚è€ƒå†…å®¹</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Eevee</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "7b9ece3e921846afa2286960d7f650a2",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

</body>
</html>
